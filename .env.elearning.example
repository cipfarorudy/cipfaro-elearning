# Configuration Production CIPFARO E-Learning - Sous-domaine
# Déploiement sur elearning.cipfaro.fr (WordPress reste sur cipfaro.fr)
# Copiez ce fichier vers .env.production et modifiez les valeurs

# =============================================================================
# CONFIGURATION SOUS-DOMAINE
# =============================================================================
NEXT_PUBLIC_DOMAIN=elearning.cipfaro.fr
NEXT_PUBLIC_API_URL=https://elearning.cipfaro.fr/api
NEXT_PUBLIC_WEB_URL=https://elearning.cipfaro.fr

# =============================================================================
# BASE DE DONNÉES POSTGRESQL
# =============================================================================
# Base de données séparée pour éviter les conflits avec WordPress
DATABASE_URL="postgresql://elearning_user:VOTRE_MOT_DE_PASSE_POSTGRES@postgres:5432/elearning_cipfaro"
POSTGRES_DB=elearning_cipfaro
POSTGRES_USER=elearning_user
POSTGRES_PASSWORD=VOTRE_MOT_DE_PASSE_POSTGRES

# =============================================================================
# PORTS ET PROXY
# =============================================================================
# Port différent pour éviter les conflits avec le site principal
NODE_ENV=production
PORT=3001
API_PORT=3002

# Le serveur web (Apache/Nginx) fera le proxy vers ce port
PROXY_TARGET_PORT=3001

# =============================================================================
# JWT ET SÉCURITÉ
# =============================================================================
# Générez des clés uniques pour le sous-domaine
JWT_SECRET=VOTRE_CLE_JWT_SECRETE_ELEARNING_32_CARACTERES
JWT_EXPIRES_IN=7d
ENCRYPTION_KEY=VOTRE_CLE_CHIFFREMENT_ELEARNING_32_CARACTERES

# =============================================================================
# REDIS (sessions et cache)
# =============================================================================
REDIS_URL=redis://redis:6379
# Préfixe pour éviter les conflits de cache
REDIS_PREFIX=elearning:

# =============================================================================
# SSL ET DOMAINE
# =============================================================================
# Utilise le certificat wildcard existant de cipfaro.fr
SSL_EMAIL=admin@cipfaro.fr
SSL_CERT_PATH=/etc/letsencrypt/live/cipfaro.fr/fullchain.pem
SSL_KEY_PATH=/etc/letsencrypt/live/cipfaro.fr/privkey.pem

# =============================================================================
# EMAIL ET NOTIFICATIONS
# =============================================================================
SMTP_HOST=smtp.lws.fr
SMTP_PORT=587
SMTP_USER=elearning@cipfaro.fr
SMTP_PASSWORD=VOTRE_MOT_DE_PASSE_EMAIL
SMTP_FROM=CIPFARO ELearning <elearning@cipfaro.fr>

# =============================================================================
# STOCKAGE SÉPARÉ
# =============================================================================
# Répertoires séparés pour éviter les conflits
UPLOAD_DIR=/app/uploads/elearning
SCORM_PACKAGE_DIR=/app/uploads/elearning/scorm
SCORM_CONTENT_DIR=/app/public/elearning/scorm
MAX_FILE_SIZE=50MB

# =============================================================================
# CORS ET SÉCURITÉ
# =============================================================================
CORS_ORIGIN=https://elearning.cipfaro.fr
CORS_CREDENTIALS=true
SECURITY_HEADERS_ENABLED=true

# =============================================================================
# CONFIGURATION APPLICATIVE
# =============================================================================
LOG_LEVEL=info
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60000

# Health check endpoint
HEALTH_CHECK_PATH=/health

# =============================================================================
# SCORM ET xAPI
# =============================================================================
XAPI_ENDPOINT=https://elearning.cipfaro.fr/xapi
XAPI_VERSION=1.0.3

# =============================================================================
# MONITORING
# =============================================================================
METRICS_ENABLED=true
METRICS_PORT=9091  # Port différent du site principal

# =============================================================================
# BACKUP
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 3 * * *  # Tous les jours à 3h du matin (après WordPress)
BACKUP_RETENTION_DAYS=30
BACKUP_PREFIX=elearning_

# =============================================================================
# VARIABLES DOCKER
# =============================================================================
WEB_IMAGE_TAG=latest
API_IMAGE_TAG=latest

# Configuration spécifique pour le sous-domaine
COMPOSE_PROJECT_NAME=cipfaro_elearning
DOCKER_NETWORK_NAME=elearning_network

# =============================================================================
# INTÉGRATION AVEC SITE PRINCIPAL
# =============================================================================
# URL du site WordPress principal pour l'intégration
WORDPRESS_SITE_URL=https://cipfaro.fr
WORDPRESS_API_URL=https://cipfaro.fr/wp-json/wp/v2

# Clé API WordPress (optionnel pour l'intégration)
# WORDPRESS_API_KEY=VOTRE_CLE_API_WORDPRESS

# =============================================================================
# INSTRUCTIONS DE CONFIGURATION
# =============================================================================
# 1. Copiez ce fichier vers .env.production
# 2. Remplacez TOUS les placeholders (VOTRE_*)
# 3. Générez des clés sécurisées uniques :
#    - JWT_SECRET : openssl rand -base64 32
#    - ENCRYPTION_KEY : openssl rand -base64 32
#    - POSTGRES_PASSWORD : openssl rand -base64 16
# 4. Configurez le virtual host Apache/Nginx pour elearning.cipfaro.fr
# 5. Testez que cipfaro.fr (WordPress) reste accessible
# 6. Déployez sur le port 3001 pour éviter les conflits

# =============================================================================
# EXEMPLE DE GÉNÉRATION DE CLÉS
# =============================================================================
# Exécutez sur votre VPS LWS :
# 
# JWT_SECRET=$(openssl rand -base64 32)
# ENCRYPTION_KEY=$(openssl rand -base64 32)  
# POSTGRES_PASSWORD=$(openssl rand -base64 16)
#
# echo "JWT_SECRET=$JWT_SECRET"
# echo "ENCRYPTION_KEY=$ENCRYPTION_KEY"
# echo "POSTGRES_PASSWORD=$POSTGRES_PASSWORD"

# =============================================================================
# VALIDATION DU DÉPLOIEMENT
# =============================================================================
# Après déploiement, vérifiez :
# 1. https://cipfaro.fr (WordPress) fonctionne toujours
# 2. https://elearning.cipfaro.fr (Next.js) est accessible
# 3. Pas de conflit de ports ou de base de données
# 4. Les certificats SSL fonctionnent pour les deux